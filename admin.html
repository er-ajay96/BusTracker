<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Admin — Live Bus Dashboard</title>

  <!-- Leaflet CSS -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  />

  <style>
    body { margin: 0; }
    #map { height: 100vh; width: 100vw; }
  </style>
</head>

<body>
<h3 style="margin:6px;">Live Bus Tracking Dashboard</h3>

<div id="map"></div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
// ------------------ FIREBASE CONFIG ------------------
const firebaseConfig = {
  apiKey: "AIzaSyC1FFRx6RDwepBKDfRJF3lRIgbKUZklwA4",
  authDomain: "realtime-database-64cef.firebaseapp.com",
  databaseURL: "https://realtime-database-64cef-default-rtdb.firebaseio.com/",
  projectId: "realtime-database-64cef",
  storageBucket: "realtime-database-64cef.firebasestorage.app",
  messagingSenderId: "705230114876",
  appId: "1:705230114876:web:6c17ee4ebb58ebfa88b339",
  measurementId: "G-QCZLL14SX5"
};
// -------------------------------------------------------

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// Initialize Leaflet map (center: India)
const map = L.map("map").setView([20.5937, 78.9629], 5);

// Add OpenStreetMap tiles (free, no API key)
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
  maxZoom: 19,
  attribution: "© OpenStreetMap"
}).addTo(map);

let markers = {};

// Listen for live location updates
db.ref("locations").on("value", snapshot => {
  const data = snapshot.val();
  if (!data) return;

  for (let user in data) {
    const { lat, lng } = data[user];

    if (!markers[user]) {
      // Create new marker
      markers[user] = L.marker([lat, lng], {
        title: user
      }).addTo(map).bindPopup(`<b>${user}</b>`);
    } else {
      // Update existing marker
      markers[user].setLatLng([lat, lng]);
    }
  }
});
</script>

</body>
</html>
